{{ $collections := site.Data.collections.collections }}

<header class="site-header">
  <div class="wrap">
    <a class="brand" href="{{ site.BaseURL }}">
      <div class="brand-mark">C D</div>
      <div>
        <p class="brand-title">Collections as Data</p>
        <p class="brand-subtitle">Temple University Digital Collections</p>
      </div>
    </a>
    <button class="nav-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="header-nav">
      <a class="nav-link" href="{{ site.BaseURL }}">Home</a>
      <div class="dropdown">
        <button class="nav-link dropdown-toggle">Collections</button>
        <div class="dropdown-menu">
          {{ $collectionPages := where site.RegularPages "Section" "collections" }}
          {{ range $collectionPages }}
          {{ if ne .Params.collection_id "railroad-photographs" }}
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          {{ end }}
          {{ end }}
        </div>
      </div>
      <div class="dropdown">
        <button class="nav-link dropdown-toggle">Trains</button>
        <div class="dropdown-menu">
          {{ $trainPages := where site.RegularPages "Section" "trains" }}
          {{ range $trainPages }}
          <a href="{{ .RelPermalink }}">{{ .Title }}</a>
          {{ end }}
        </div>
      </div>
      <a class="nav-link" href="https://digital.library.temple.edu/" target="_blank">Temple Libraries</a>
    </nav>
  </div>
</header>

<script>
(function() {
  // Mobile nav toggle
  var toggle = document.querySelector('.nav-toggle');
  var nav = document.querySelector('.header-nav');
  if (toggle) {
    toggle.addEventListener('click', function() {
      nav.classList.toggle('open');
      toggle.classList.toggle('open');
    });
  }

  // Dropdown: hover on desktop, click on mobile
  var isTouchDevice = 'ontouchstart' in window;
  document.querySelectorAll('.dropdown').forEach(function(dd) {
    var btn = dd.querySelector('.dropdown-toggle');
    if (!isTouchDevice) {
      dd.addEventListener('mouseenter', function() {
        document.querySelectorAll('.dropdown.open').forEach(function(d) { d.classList.remove('open'); });
        dd.classList.add('open');
      });
      dd.addEventListener('mouseleave', function() {
        dd.classList.remove('open');
      });
    }
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      var wasOpen = dd.classList.contains('open');
      document.querySelectorAll('.dropdown.open').forEach(function(d) { d.classList.remove('open'); });
      if (!wasOpen) dd.classList.add('open');
    });
  });

  // Close dropdowns when clicking outside
  document.addEventListener('click', function() {
    document.querySelectorAll('.dropdown.open').forEach(function(d) {
      d.classList.remove('open');
    });
  });
})();
</script>
